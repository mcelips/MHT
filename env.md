# Заметки по ENV

### Плюсы ENV
* Имя и расширение конфигурационного файла (.env) отличается от исполняемых файлов (например, .php), что позволяет легко его найти.
* Так как файл .env хранится в корне приложения и вся конфигурация находится в одном файле, его легко можно исключить из загрузки на репозиторий.
* Переменные окружения независимы от языка и ОС, легко могут быть развернуты в любом окружении.

### Недостакти
Когда вы храните свои секретные ключи в среде, вы все равно можете случайно их раскрыть - именно этого мы и хотим избежать.

Давайте подробнее рассмотрим окружение и переменные окружения. Это функция любой ОС, которую вы будете использовать для размещения веб-приложений, включая Linux, MacOS и Windows. Переменные среды использовались для конфигурации системы практически навсегда и предназначены для передачи конфигурации от родительского процесса к его дочерним процессам. Дочерний процесс по умолчанию наследует копию всех переменных среды (называемых средой) от своего родительского процесса.
И в этих свойствах среды кроются проблемы, когда она используется для хранения секретных ключей:
* Среда неявно доступна процессу. Трудно отслеживать доступ и то, как раскрывается его содержимое. Легко захватить всю среду и распечатать ее (может быть полезно для отладки) или, например, отправить как часть отчета об ошибке.
* Вся среда передается дочерним процессам (если не фильтруется явно), что нарушает принцип наименьших привилегий. Таким образом, ваши секретные ключи неявно становятся доступными для любых сторонних инструментов, которые вы используете (например, ImageMagick для изменения размера изображения). Трудно сказать, что эти сторонние инструменты будут делать с окружающей средой, особенно в редких случаях, таких как сбои.
* Внешние разработчики не обязательно знают, что ваша среда содержит секретные ключи. Таким образом ваши требования (строго контролируемый доступ) больше не соответствуют неявным ожиданиям большинства разработчиков (ничего особенного в среде, только общая конфигурация системы). Это опасное несоответствие.

При работе с переменными окружения в PHP-проекте, вы хотите убедиться, что ваш код всегда будет получать переменную из надежного источника, будь то $_ENV, $_SERVER, getenv... Но эти три метода не возвращают одинаковые результаты!
```bash
$ php -r "echo getenv('HOME');"
/home/foobar

$ php -r 'echo $_ENV["HOME"];'
PHP Notice: Undefined index: HOME

$ php -r 'echo $_SERVER["HOME"];'
/home/foobar
```
Это потому что настройка variables_order в PHP на моей машине установлена в "GPCS". И так как в ней нет буквы "E", я не могу полагаться на суперглобальный массив $_ENV. Это может привести к тому, что код работающий на одном PHP не будет работать на другом.

Другой камень преткновения – это то, что разработчики не хотят управлять переменными окружения локально. Каждый раз, когда мы редактируем VirtualHost, мы не хотим перезагружать php-fpm или некую службу, или очищать кеш... Разработчики хотят иметь простой и безболезненный способ настройки переменных окружения... как .env файл!
